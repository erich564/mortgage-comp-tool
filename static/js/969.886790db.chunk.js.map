{"version":3,"file":"static/js/969.886790db.chunk.js","mappings":"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","sources":["ChartOptions.js","Report.js"],"sourcesContent":["import Highcharts, { merge } from 'highcharts';\r\nimport moment from 'moment';\r\n\r\nconst yAxisLabelFormat = '${value:,.0f}';\r\n\r\nHighcharts.setOptions({\r\n  lang: {\r\n    thousandsSep: ',',\r\n  },\r\n});\r\n\r\nlet commonOptions;\r\n\r\n/**\r\n * Determines min/max dates that will cover both mortgage amortization time periods.\r\n * Then adds some padding to those dates so the data is not pushing up against the\r\n * ends of the chart.\r\n */\r\nconst calcMinMaxDates = mortgages => {\r\n  const m1 = mortgages[0];\r\n  const m2 = mortgages[1];\r\n  const minDate = moment.min(m1.startDate, m2.startDate).clone();\r\n  const maxDate = moment.max(m1.endDate, m2.endDate).clone();\r\n  const diff = maxDate.diff(minDate, 'days');\r\n  const margin = 0.02;\r\n  const padding = diff * margin;\r\n  minDate.subtract(padding, 'days');\r\n  maxDate.add(padding, 'days');\r\n  const minDateMs = minDate.valueOf();\r\n  const maxDateMs = maxDate.valueOf();\r\n  return { minDateMs, maxDateMs };\r\n};\r\n\r\nexport const setCommonOptions = mortgages => {\r\n  const { minDateMs, maxDateMs } = calcMinMaxDates(mortgages);\r\n  commonOptions = {\r\n    chart: {\r\n      type: 'spline',\r\n      zoomType: 'x',\r\n    },\r\n    plotOptions: {\r\n      series: {\r\n        states: {\r\n          hover: {\r\n            lineWidthPlus: 0,\r\n          },\r\n        },\r\n      },\r\n    },\r\n    xAxis: {\r\n      type: 'datetime',\r\n      min: minDateMs,\r\n      max: maxDateMs,\r\n    },\r\n    yAxis: {\r\n      title: {\r\n        text: null,\r\n      },\r\n      labels: {\r\n        format: yAxisLabelFormat,\r\n      },\r\n    },\r\n    tooltip: {\r\n      shared: true,\r\n      crosshairs: true,\r\n      // xDateFormat: '%b %Y',\r\n      xDateFormat: '%m-%Y',\r\n      headerFormat: '{point.key}<br/>',\r\n      valuePrefix: '$',\r\n    },\r\n  };\r\n};\r\n\r\nexport const createComparisonChartOptions = (comparison, mortgages) =>\r\n  merge(commonOptions, {\r\n    title: {\r\n      text: 'Mortgages Compared',\r\n    },\r\n    series: [\r\n      {\r\n        name: 'Net Worth Difference',\r\n        data: comparison.map(c => ({\r\n          x: c.unixTimeMs,\r\n          y: c.difference,\r\n        })),\r\n      },\r\n      ...mortgages.map(m => ({\r\n        name: `${m.name} Net Worth`,\r\n        data: m.netWorth.map(nw => ({\r\n          x: nw.unixTimeMs,\r\n          y: nw.netWorth,\r\n        })),\r\n      })),\r\n      ...mortgages.map(m => ({\r\n        name: `${m.name} Cash`,\r\n        data: m.netWorth.map(nw => ({\r\n          x: nw.unixTimeMs,\r\n          y: nw.cash,\r\n        })),\r\n        visible: false,\r\n      })),\r\n      ...mortgages.map(m => ({\r\n        name: `${m.name} Equity`,\r\n        data: m.netWorth.map(nw => ({\r\n          x: nw.unixTimeMs,\r\n          y: nw.equity,\r\n        })),\r\n        visible: false,\r\n      })),\r\n    ],\r\n    tooltip: {\r\n      valueDecimals: 0,\r\n    },\r\n  });\r\n\r\nexport const createCumulativeChartOptions = mortgages =>\r\n  merge(commonOptions, {\r\n    title: {\r\n      text: `Cumulative Payments`,\r\n    },\r\n    series: [\r\n      ...mortgages.map(m => ({\r\n        name: `${m.name} Payments`,\r\n        data: m.payments.map(p => ({\r\n          x: p.unixTimeMs,\r\n          y: p.cumPayments,\r\n        })),\r\n      })),\r\n      ...mortgages.map(m => ({\r\n        name: `${m.name} Principal`,\r\n        data: m.payments.map(p => ({\r\n          x: p.unixTimeMs,\r\n          y: p.cumPrincipal,\r\n        })),\r\n        visible: false,\r\n      })),\r\n      ...mortgages.map(m => ({\r\n        name: `${m.name} Interest`,\r\n        data: m.payments.map(p => ({\r\n          x: p.unixTimeMs,\r\n          y: p.cumInterest,\r\n        })),\r\n        visible: false,\r\n      })),\r\n    ],\r\n    tooltip: {\r\n      valueDecimals: 0,\r\n    },\r\n  });\r\n\r\nexport const createAmortizationChartOptions = m =>\r\n  merge(commonOptions, {\r\n    title: {\r\n      text: `${m.name} Amortization`,\r\n    },\r\n    series: [\r\n      {\r\n        name: 'Principal',\r\n        data: m.payments.map(payment => ({\r\n          x: payment.unixTimeMs,\r\n          y: payment.principal,\r\n        })),\r\n      },\r\n      {\r\n        name: 'Interest',\r\n        data: m.payments.map(payment => ({\r\n          x: payment.unixTimeMs,\r\n          y: payment.interest,\r\n        })),\r\n      },\r\n    ],\r\n    tooltip: {\r\n      valueDecimals: 2,\r\n    },\r\n  });\r\n","import { Divider } from '@mui/material';\r\nimport clone from 'clone';\r\nimport Highcharts from 'highcharts';\r\nimport HighchartsReact from 'highcharts-react-official';\r\nimport { memo } from 'react';\r\nimport {\r\n  createAmortizationChartOptions,\r\n  createComparisonChartOptions,\r\n  createCumulativeChartOptions,\r\n  setCommonOptions,\r\n} from './ChartOptions';\r\nimport { termToMonths } from './MortgageTerm';\r\nimport { MortgageType, yearsUntilFirstAdjust } from './MortgageType';\r\n\r\nconst monthsPerYear = 12;\r\n\r\n/**\r\n * Convert annual rate to monthly rate (with monthly compounding).\r\n */\r\nconst calcMonthlyRoi = n => (1 + n) ** (1 / monthsPerYear) - 1;\r\n\r\n/** Round to 2 decimal places */\r\n// eslint-disable-next-line prefer-template\r\nconst roundToTwo = num => +(Math.round(+`${num}e+2`) + 'e-2');\r\n\r\n/**\r\n * Calculate monthly loan payment amount\r\n * @param {number} p Remaining principal for the loan.\r\n * @param {number} i Monthly interest rate.\r\n * @param {number} t Remaining months for the loan. (term)\r\n */\r\nconst calcMonthlyPayment = (p, i, t) => {\r\n  const x = (1 + i) ** t;\r\n  return roundToTwo((p * (i * x)) / (x - 1));\r\n};\r\n\r\nconst transformState = reportState => {\r\n  const state = clone(reportState);\r\n  state.roi /= 100;\r\n  state.monthlyRoi = calcMonthlyRoi(state.roi);\r\n  state.marginalTaxRate /= 100;\r\n  for (const m of state.mortgages) {\r\n    m.name = `Mortgage ${m.id}`;\r\n    m.interestRate /= 100;\r\n    m.loanAmount = +m.loanAmount;\r\n    m.term = termToMonths(m.term);\r\n    m.endDate = m.startDate.clone().add(m.term - 1, 'months');\r\n    if (m.type !== MortgageType.FixedRate) {\r\n      const years = yearsUntilFirstAdjust(m.type);\r\n      const intRate = m.interestRateAdjusted / 100;\r\n      m.rateAdjust = {\r\n        interestRate: intRate,\r\n        monthlyInterestRate: intRate / monthsPerYear,\r\n        adjustDate: m.startDate.clone().add(years, 'years'),\r\n      };\r\n    }\r\n    m.monthlyInterestRate = m.interestRate / monthsPerYear;\r\n    m.monthlyPayment = calcMonthlyPayment(\r\n      m.loanAmount,\r\n      m.monthlyInterestRate,\r\n      m.term\r\n    );\r\n    m.payments = [];\r\n    m.netWorth = [];\r\n    m.closingCosts = +m.closingCosts;\r\n    delete m.interestRateAdjusted;\r\n  }\r\n  return state;\r\n};\r\n\r\n/**\r\n * Builds amortization schedule for a mortgages, with each payment's principal\r\n * and interest portions.\r\n */\r\nconst createAmortizationSchedules = mortgages => {\r\n  for (const m of mortgages) {\r\n    let b = m.loanAmount;\r\n    let intRate = m.monthlyInterestRate;\r\n    const date = m.startDate.clone();\r\n    let { monthlyPayment } = m;\r\n    let prevPayment;\r\n    while (b > 0) {\r\n      const int = roundToTwo(b * intRate);\r\n      let prin;\r\n      // on the very last payment, pay off remaining balance due to rounding over time\r\n      if (date.isSame(m.endDate)) {\r\n        prin = b;\r\n      } else {\r\n        prin = roundToTwo(monthlyPayment - int);\r\n      }\r\n      const bStart = roundToTwo(b);\r\n      const bEnd = roundToTwo(bStart - prin);\r\n      b = bEnd;\r\n      const cumPrin = roundToTwo(\r\n        prin + (prevPayment ? prevPayment.cumPrincipal : 0)\r\n      );\r\n      const cumInt = roundToTwo(\r\n        int + (prevPayment ? prevPayment.cumInterest : 0)\r\n      );\r\n      const cumPayments = roundToTwo(cumPrin + cumInt);\r\n      const payment = {\r\n        principal: prin,\r\n        interest: int,\r\n        date: date.clone(),\r\n        unixTimeMs: date.valueOf(),\r\n        startingBalance: bStart,\r\n        remainingBalance: bEnd,\r\n        cumPrincipal: cumPrin,\r\n        cumInterest: cumInt,\r\n        cumPayments,\r\n      };\r\n      m.payments.push(payment);\r\n      date.add(1, 'month');\r\n      prevPayment = payment;\r\n      if (m.rateAdjust && date.isSame(m.rateAdjust.adjustDate)) {\r\n        intRate = m.rateAdjust.monthlyInterestRate;\r\n        const t = m.term - m.rateAdjust.adjustDate.diff(m.startDate, 'months');\r\n        monthlyPayment = calcMonthlyPayment(b, intRate, t);\r\n        m.rateAdjust.monthlyPayment = monthlyPayment;\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Creates data for comparing cash, equity, and net worth comparisons of the two\r\n * mortgages over their life time.\r\n */\r\nconst compareMortgages = ({\r\n  mortgages,\r\n  isRefinance,\r\n  doItemize,\r\n  marginalTaxRate,\r\n  monthlyRoi,\r\n}) => {\r\n  const m1 = mortgages[0];\r\n  const m2 = mortgages[1];\r\n  let m1n = 0;\r\n  let m2n = 0;\r\n  const m1PayLen = m1.payments.length;\r\n  const m2PayLen = m2.payments.length;\r\n\r\n  // fast-forward m1 payment schedule to first payment date of m2\r\n  while (m1.payments[m1n] && !m1.payments[m1n].date.isSame(m2.startDate)) m1n++;\r\n\r\n  let m1Cash;\r\n  let m2Cash;\r\n  let m1Equity = 0;\r\n  let m2Equity;\r\n\r\n  if (isRefinance) {\r\n    m1Cash = 0;\r\n    m2Cash = roundToTwo(\r\n      m2.loanAmount - m1.payments[m1n].startingBalance - m2.closingCosts\r\n    );\r\n    m2Equity = -m2Cash;\r\n  } else {\r\n    m1Cash = -m1.closingCosts;\r\n    m2Cash = -m2.closingCosts;\r\n    m2Equity = 0;\r\n  }\r\n\r\n  let m1PrevCash;\r\n  let m2PrevCash;\r\n  const netWorthDifferences = [];\r\n  let m1Payment = m1.monthlyPayment;\r\n  let m2Payment = m2.monthlyPayment;\r\n\r\n  while (m1n < m1PayLen || m2n < m2PayLen) {\r\n    const eitherPayment = m1n < m1PayLen ? m1.payments[m1n] : m2.payments[m2n];\r\n    const { date } = eitherPayment;\r\n    const { unixTimeMs } = eitherPayment;\r\n    let m1NetWorth;\r\n    let m2NetWorth;\r\n\r\n    if (m1n < m1PayLen) {\r\n      if (m1.rateAdjust && date.isSame(m1.rateAdjust.adjustDate))\r\n        m1Payment = m1.rateAdjust.monthlyPayment;\r\n      const accruedInt = m1PrevCash === undefined ? 0 : m1PrevCash * monthlyRoi;\r\n      m1Cash = m1Cash - m1Payment + accruedInt;\r\n      if (doItemize) m1Cash += m1.payments[m1n].interest * marginalTaxRate;\r\n      m1Equity += m1.payments[m1n].principal;\r\n      m1NetWorth = m1Cash + m1Equity;\r\n      m1.netWorth.push({\r\n        unixTimeMs,\r\n        cash: m1Cash,\r\n        equity: m1Equity,\r\n        netWorth: m1NetWorth,\r\n      });\r\n      m1PrevCash = m1Cash;\r\n      m1n++;\r\n    }\r\n\r\n    if (m2n < m2PayLen) {\r\n      if (m2.rateAdjust && date.isSame(m2.rateAdjust.adjustDate))\r\n        m2Payment = m2.rateAdjust.monthlyPayment;\r\n      const accruedInt = m2PrevCash === undefined ? 0 : m2PrevCash * monthlyRoi;\r\n      m2Cash = m2Cash - m2Payment + accruedInt;\r\n      if (doItemize) m2Cash += m2.payments[m2n].interest * marginalTaxRate;\r\n      m2Equity += m2.payments[m2n].principal;\r\n      m2NetWorth = m2Cash + m2Equity;\r\n      m2.netWorth.push({\r\n        unixTimeMs,\r\n        cash: m2Cash,\r\n        equity: m2Equity,\r\n        netWorth: m2NetWorth,\r\n      });\r\n      m2PrevCash = m2Cash;\r\n      m2n++;\r\n    }\r\n\r\n    if (m1NetWorth && m2NetWorth) {\r\n      netWorthDifferences.push({\r\n        unixTimeMs,\r\n        difference: m2NetWorth - m1NetWorth,\r\n      });\r\n    }\r\n  }\r\n\r\n  return netWorthDifferences;\r\n};\r\n\r\nfunction Report({ reportState }) {\r\n  const state = transformState(reportState);\r\n  createAmortizationSchedules(state.mortgages);\r\n  const comparison = compareMortgages(state);\r\n  setCommonOptions(state.mortgages);\r\n\r\n  return (\r\n    <>\r\n      <Divider variant=\"middle\" />\r\n      <br />\r\n      <HighchartsReact\r\n        highcharts={Highcharts}\r\n        options={createComparisonChartOptions(comparison, state.mortgages)}\r\n      />\r\n      <HighchartsReact\r\n        highcharts={Highcharts}\r\n        options={createCumulativeChartOptions(state.mortgages)}\r\n      />\r\n      {state.mortgages.map(m => (\r\n        <HighchartsReact\r\n          key={m.id}\r\n          highcharts={Highcharts}\r\n          options={createAmortizationChartOptions(m)}\r\n        />\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default memo(Report);\r\n"],"names":["commonOptions","Highcharts","lang","thousandsSep","setCommonOptions","mortgages","m1","m2","minDate","moment","startDate","clone","maxDate","endDate","padding","diff","subtract","add","minDateMs","valueOf","maxDateMs","calcMinMaxDates","chart","type","zoomType","plotOptions","series","states","hover","lineWidthPlus","xAxis","min","max","yAxis","title","text","labels","format","tooltip","shared","crosshairs","xDateFormat","headerFormat","valuePrefix","createComparisonChartOptions","comparison","merge","name","data","map","c","x","unixTimeMs","y","difference","m","netWorth","nw","cash","visible","equity","valueDecimals","createAmortizationChartOptions","payments","payment","principal","interest","roundToTwo","num","Math","round","calcMonthlyPayment","p","i","t","transformState","reportState","n","state","roi","monthlyRoi","marginalTaxRate","id","interestRate","loanAmount","term","termToMonths","MortgageType","years","yearsUntilFirstAdjust","intRate","interestRateAdjusted","rateAdjust","monthlyInterestRate","adjustDate","monthlyPayment","closingCosts","Report","b","date","prevPayment","int","prin","isSame","bStart","bEnd","cumPrin","cumPrincipal","cumInt","cumInterest","cumPayments","startingBalance","remainingBalance","push","createAmortizationSchedules","m1Cash","m2Cash","isRefinance","doItemize","m1n","m2n","m1PayLen","length","m2PayLen","m2Equity","m1PrevCash","m2PrevCash","m1Equity","netWorthDifferences","m1Payment","m2Payment","eitherPayment","m1NetWorth","m2NetWorth","undefined","compareMortgages","Divider","variant","highcharts","options","memo"],"sourceRoot":""}